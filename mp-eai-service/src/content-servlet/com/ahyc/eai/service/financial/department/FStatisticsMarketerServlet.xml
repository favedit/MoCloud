<?xml version="1.0" encoding="UTF-8" ?>

<Config>

<Resource name='sql.organization.level2'>
SELECT
   DEPARTMENT_LEVEL2_ID     AS ID,
   DEPARTMENT_LEVEL2_LABEL  AS LABEL,
   COUNT(*)                 MARKETER_COUNT,
   SUM(INVESTMENT_TOTAL)    INVESTMENT_TOTAL,
   SUM(REDEMPTION_TOTAL)    REDEMPTION_TOTAL,
   SUM(NETINVESTMENT_TOTAL) NETINVESTMENT_TOTAL,
   SUM(INTEREST_TOTAL)      INTEREST_TOTAL
FROM ST_FIN_MARKETER
WHERE STATUS_CD = 0 AND DEPARTMENT_LEVEL2_ID > 0
GROUP BY DEPARTMENT_LEVEL2_ID
ORDER BY SUM(INVESTMENT_TOTAL) DESC
</Resource>

<Resource name='sql.organization.level4'>
SELECT
   DEPARTMENT_LEVEL4_ID     ID,
   DEPARTMENT_LEVEL2_LABEL  PARENT_LABEL,
   DEPARTMENT_LEVEL4_LABEL  LABEL,
   COUNT(*)                 MARKETER_COUNT,
   SUM(INVESTMENT_TOTAL)    INVESTMENT_TOTAL,
   SUM(REDEMPTION_TOTAL)    REDEMPTION_TOTAL,
   SUM(NETINVESTMENT_TOTAL) NETINVESTMENT_TOTAL,
   SUM(INTEREST_TOTAL)      INTEREST_TOTAL
FROM ST_FIN_MARKETER
WHERE STATUS_CD = 0 AND DEPARTMENT_LEVEL4_ID > 0
GROUP BY DEPARTMENT_LEVEL4_ID
ORDER BY SUM(INVESTMENT_TOTAL) DESC
</Resource>

<Resource name='sql.organization.area'>
SELECT
   LEFT(CARD, 4)            MARKETER_CARD,
   COUNT(*)                 MARKETER_COUNT,
   SUM(INVESTMENT_TOTAL)    INVESTMENT_TOTAL,
   SUM(REDEMPTION_TOTAL)    REDEMPTION_TOTAL,
   SUM(NETINVESTMENT_TOTAL) NETINVESTMENT_TOTAL,
   SUM(INTEREST_TOTAL)      INTEREST_TOTAL
FROM ST_FIN_MARKETER
WHERE STATUS_CD = 0
GROUP BY LEFT(CARD, 4)
ORDER BY CARD
</Resource>

<Resource name='sql.dynamic.sum'>
SELECT
   SUM(INVESTMENT) INVESTMENT_COUNT,
   MAX(INVESTMENT_TOTAL) INVESTMENT_TOTAL,
   SUM(REDEMPTION) REDEMPTION_COUNT,
   MAX(REDEMPTION_TOTAL) REDEMPTION_TOTAL,
   SUM(NETINVESTMENT) NETINVESTMENT_COUNT,
   MAX(NETINVESTMENT_TOTAL) NETINVESTMENT_TOTAL,
   SUM(INTEREST) INTEREST_COUNT,
   MAX(INTEREST_TOTAL) INTEREST_TOTAL,
   SUM(PERFORMANCE) PERFORMANCE_COUNT,
   MAX(PERFORMANCE_TOTAL) PERFORMANCE_TOTAL,
   SUM(CUSTOMER_COUNT) CUSTOMER_COUNT,
   MAX(CUSTOMER_TOTAL) CUSTOMER_TOTAL
FROM ST_FIN_PHASE
WHERE RECORD_DAY = STR_TO_DATE({date},'%Y%m%d')
</Resource>

<Resource name='sql.dynamic.rank.day'>
SELECT * FROM (
   SELECT
      DEPARTMENT_ID,
      DEPARTMENT_LABEL,
      MARKETER_ID,
      MARKETER_LABEL,
      SUM(MARKETER_INVESTMENT) INVESTMENT_TOTAL,
      SUM(MARKETER_REDEMPTION) REDEMPTION_TOTAL,
      SUM(MARKETER_NETINVESTMENT) NETINVESTMENT_TOTAL,
      SUM(MARKETER_INTEREST) INTEREST_TOTAL,
      SUM(MARKETER_PERFORMANCE) PERFORMANCE_TOTAL,
      SUM(CUSTOMER_COUNT) CUSTOMER_COUNT,
      MAX(CUSTOMER_TOTAL) CUSTOMER_TOTAL
   FROM ST_FIN_MARKETER_PHASE
   WHERE RECORD_DAY = STR_TO_DATE({date},'%Y%m%d')
   GROUP BY MARKETER_ID
) t
ORDER BY NETINVESTMENT_TOTAL DESC
LIMIT 3
</Resource>

<Resource name='sql.dynamic.rank.week'>
SELECT * FROM (
   SELECT
      DEPARTMENT_ID,
      DEPARTMENT_LABEL,
      MARKETER_ID,
      MARKETER_LABEL,
      SUM(MARKETER_INVESTMENT) INVESTMENT_TOTAL,
      SUM(MARKETER_REDEMPTION) REDEMPTION_TOTAL,
      SUM(MARKETER_NETINVESTMENT) NETINVESTMENT_TOTAL,
      SUM(MARKETER_INTEREST) INTEREST_TOTAL,
      SUM(MARKETER_PERFORMANCE) PERFORMANCE_TOTAL,
      SUM(CUSTOMER_COUNT) CUSTOMER_COUNT,
      MAX(CUSTOMER_TOTAL) CUSTOMER_TOTAL
   FROM ST_FIN_MARKETER_PHASE
   WHERE RECORD_WEEK = STR_TO_DATE({date},'%Y%m%d')
   GROUP BY MARKETER_ID
) t
ORDER BY NETINVESTMENT_TOTAL DESC
LIMIT 3
</Resource>

<Resource name='sql.dynamic.rank.month'>
SELECT * FROM (
   SELECT
      DEPARTMENT_ID,
      DEPARTMENT_LABEL,
      MARKETER_ID,
      MARKETER_LABEL,
      SUM(MARKETER_INVESTMENT) INVESTMENT_TOTAL,
      SUM(MARKETER_REDEMPTION) REDEMPTION_TOTAL,
      SUM(MARKETER_NETINVESTMENT) NETINVESTMENT_TOTAL,
      SUM(MARKETER_INTEREST) INTEREST_TOTAL,
      SUM(MARKETER_PERFORMANCE) PERFORMANCE_TOTAL,
      SUM(CUSTOMER_COUNT) CUSTOMER_COUNT,
      MAX(CUSTOMER_TOTAL) CUSTOMER_TOTAL
   FROM ST_FIN_MARKETER_PHASE
   WHERE RECORD_MONTH = STR_TO_DATE({date},'%Y%m%d')
   GROUP BY MARKETER_ID
) t
ORDER BY NETINVESTMENT_TOTAL DESC
LIMIT 3
</Resource>

</Config>